<!DOCTYPE html>
<html>
<head>
     <meta charset="utf-8" />
     <title>Mapa</title>
     <meta name="viewport" content="width=device-width, initial-scale=1.0">

     <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
     <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

     <style>
     html, body, #map { height: 100%; margin: 0; padding: 0; }
     </style>
</head>

<body>
     <div id="map"></div>

     <script>
     const map = L.map('map').setView([4.65, -74.05], 12);
     L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19
     }).addTo(map);

     let markers = [];

     window.loadStations = function(stations) {
          // If stations is a JS array (passed from Java via executeScript),
          // ensure it's an array of objects with keys lat, lng, id, name.
          try {
          // when Java passes a JS literal like [{id:'A', name:'X', lat:4.6, lng:-74.0}, ...]
          // it's already an object/array. If it's a String JSON, parse it.
          let arr = stations;
          if (typeof stations === 'string') arr = JSON.parse(stations);

          // clear
          markers.forEach(m => map.removeLayer(m));
          markers = [];
          if (!arr || arr.length === 0) return;

          // center on first
          map.setView([arr[0].lat, arr[0].lng], 13);

          arr.forEach(s => {
               if (s.lat == null || s.lng == null) return;
               const m = L.marker([s.lat, s.lng]).addTo(map).bindPopup(`<b>${s.id}</b><br/>${s.name || ''}`);
               markers.push(m);
          });
          } catch (e) {
          console.error("loadStations error", e);
          }
     };
  </script>
</body>
</html>